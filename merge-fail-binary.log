changed in both
  base   100644 0de95aa7a72924b9a90e52731603bf040342fef3 envelope.png
  our    100644 dce645ea11a5978be3a42fb5f2be1a8e67f010ae envelope.png
  their  100644 4a1e3c452737acb769e4c3710fdc8a874b66842d envelope.png
warning: Cannot merge binary files: envelope.png (.our vs. .their)

merged
  result 100644 4109e42ac3ea7e3a429e34ea50e1fdf6f4d5a1af gistory/Graph.h
  our    100644 ce12afb10ac608bcfc6aac0b65c46907411bcb34 gistory/Graph.h
@@ -13,6 +13,7 @@
 /**Handles importing repositories generating the graph data structure */
 @interface Graph : NSObject
 
+@property (nonatomic, strong) Node *currentNode;
 @property (nonatomic, strong) NSMutableArray *roots;
 
 +(void)exportGraphFromPath:(NSString*)path withName:(NSString*)name;
merged
  result 100644 a219f37a92cb3a1cf4a64817a9329a0058c78755 gistory/Graph.m
  our    100644 646f7ef49fc9cb3f1346fb446bebc8036ac43d4d gistory/Graph.m
@@ -10,6 +10,9 @@
 #import "NSRegularExpression+helpers.h"
 #import "Node+GraphAlgorithms.h"
 
+#define CURRENT_VERSION @"2"
+#define NUM_HEADERS 2
+
 #define GIT_PATH @"/usr/bin/git"
 #define LOG_SEPARATOR @","
 #define PARENT_SEPARATOR @"\\s+"
@@ -28,20 +31,25 @@
 @synthesize commits;
 @synthesize numEdges;
 @synthesize roots;
+@synthesize currentNode;
 
 +(void)exportGraphFromPath:(NSString*)path withName:(NSString*)name
 {
     //commit hash, parent hashes, author, date timestamp
     NSArray *components = [NSArray arrayWithObjects:@"%H", @"%P", @"%an", @"%at", nil];
     NSString *format = [NSString stringWithFormat:@"--format='%@'", [components componentsJoinedByString:LOG_SEPARATOR]];
-    NSData *log = [Graph executeCommand:GIT_PATH inDir:path withArgs:[NSArray arrayWithObjects:@"log", @"--all", @"--full-history", format, nil]];
-    assert([log writeToFile:name atomically:NO]);
+    NSString *version = CURRENT_VERSION;
+    NSString *log = [Graph executeCommand:GIT_PATH inDir:path withArgs:[NSArray arrayWithObjects:@"log", @"-n", @"1", @"--format='%H'", nil]];
+    NSString *fullLog = [Graph executeCommand:GIT_PATH inDir:path withArgs:[NSArray arrayWithObjects:@"log", @"--all", @"--full-history", format, nil]];
+    NSString *outStr = [NSString stringWithFormat:@"%@\n%@%@", version, log, fullLog];
+    [outStr writeToFile:name atomically:NO encoding:NSUTF8StringEncoding error:nil];
 }
 
 -(id)initWithDirectory:(NSString*)path
 {
     if(self = [super init])
     {
+        self.currentNode = nil;
         self.roots = [NSMutableArray array];
         self.commits = [NSMutableDictionary dictionary];
         [Graph exportGraphFromPath:path withName:@"gistory.log"];
@@ -77,7 +85,15 @@
     NSRegularExpression *componentSplitter = [NSRegularExpression regularExpressionWithSafePattern:LOG_SEPARATOR];
     NSRegularExpression *lineSplitter = [NSRegularExpression regularExpressionWithSafePattern:@"(\n|\r|\r\n)"];
     NSRegularExpression *parentSplitter = [NSRegularExpression regularExpressionWithSafePattern:PARENT_SEPARATOR];
-    for(__strong NSString *entry in [lineSplitter split:log])
+    NSArray *lines = [lineSplitter split:log];
+    NSString *version = [lines objectAtIndex:0];
+    NSAssert([version isEqualToString:CURRENT_VERSION], @"This is an old log file and needs to be regenerated with [graph exportGraphFromPath:");
+
+    NSString *entry = [lines objectAtIndex:1];
+    NSArray *items = [componentSplitter split:entry];
+    NSString *currentCommit = [items objectAtIndex:0];
+    currentCommit = [currentCommit substringWithRange:NSMakeRange(1, currentCommit.length-2)];
+    for(__strong NSString *entry in [lines subarrayWithRange:NSMakeRange(NUM_HEADERS, lines.count-NUM_HEADERS)])
     {
         //the file format has ' around the lines
         entry = [entry substringWithRange:NSMakeRange(1, entry.length-2)];
@@ -88,6 +104,10 @@
         NSString *author = [items objectAtIndex:2];
         NSDate *date = [NSDate dateWithTimeIntervalSince1970:((NSString*)[items objectAtIndex:3]).doubleValue];
         Node *node = [Node nodeWithName:commit author:author date:date];
+        if(!self.currentNode)
+        {
+            self.currentNode = node;
+        }
         if([ret objectForKey:commit])
         {
             NSAssert(NO, @"Apparently need to handle seeing the same commit again...");
@@ -97,17 +117,18 @@
         NSAssert(node, @"no node");
         [ret setObject: addtoRet forKey:node.name];
     }
+    NSAssert(self.currentNode, @"Uh... where are you? And how did you get there?");
     
     //now patch together the parent/child relationships
     for(NSString *key in [ret keyEnumerator])
     {
-        Node *currentNode = [[ret objectForKey:key] objectAtIndex:0];
-        NSAssert(currentNode, @"Grabbed a null node");
+        Node *current = [[ret objectForKey:key] objectAtIndex:0];
+        NSAssert(current, @"Grabbed a null node");
         NSArray *parents = [[ret objectForKey:key] objectAtIndex:1];
         NSAssert(parents, @"parent issue");
         if(parents.count == 0)
         {
-            [self.roots addObject:currentNode];
+            [self.roots addObject:current];
         }
         else
         {
@@ -115,12 +136,12 @@
             {
                 numEdges++;
                 Node *parentNode = [[ret objectForKey:parent] objectAtIndex:0];
-                Edge *edge = [Edge edgeWithHead:parentNode andTail:currentNode];
+                Edge *edge = [Edge edgeWithHead:parentNode andTail:current];
                 NSAssert(parentNode, @"Null parent node %@", parent);
                 //[parentNode.next addObject:currentNode];
                 //[currentNode.prev addObject:parentNode];
                 [parentNode.nextEdges addObject:edge];
-                [currentNode.prevEdges addObject:edge];
+                [current.prevEdges addObject:edge];
             }
         }
     }
added in local
  our    100644 9aa36e723869cbefd27e70e6f19be1214edcc7fb gistoryTests/RailLogicTests.h
added in local
  our    100644 e4736809bf3623ddd56c9a935ff6a549eb114c39 gistoryTests/RailLogicTests.m
added in local
  our    100644 8ead1eed957797ec47e0f8ca58c746ef9776657d parseLog.php
merged
  result 100644 1b373739355e70e43acbccec217df86a7e624717 semaps.log
  our    100644 696b3c0e35d231109a67b0f047a0cf32bfcb705a semaps.log
@@ -1,3 +1,27 @@
+2
+'26533af3b2f8a939b7a6e75b02fee240ab9d4208'
+'b65ef7b0ac3d1d0c3ccd3d3fef8ed92ec0c6f855,f624104621ff34dfc27b4033f4c61f644a24a498 d9d00ab4be6eda4495550d9801cc66958c00a12c,Drew Crawford,1313534032'
+'f624104621ff34dfc27b4033f4c61f644a24a498,aa8303d23728a64565bfd400a002ad35344e51c8 a83490b6bb52a43914941dfe87570b338ca31bb4,Drew Crawford,1313533337'
+'aa8303d23728a64565bfd400a002ad35344e51c8,17fa6188936f7e61b298ced30c738f0c6fae68d9 e5237aea3971e9854268c1a79e03f16583cf8ff6,Drew Crawford,1313532703'
+'e5237aea3971e9854268c1a79e03f16583cf8ff6,80a6cb3dfd727f5f70539bf8c56ed99d1e72f8fa 17fa6188936f7e61b298ced30c738f0c6fae68d9,Drew Crawford,1313532617'
+'17fa6188936f7e61b298ced30c738f0c6fae68d9,50683480284c8fa2b378ea4955db2f0cf87d55db b4a48a0d8e4f2adbd26d1c4c4627d9bcbd7a4cd5,Drew Crawford,1313531206'
+'50683480284c8fa2b378ea4955db2f0cf87d55db,50350c845ebd14601bb70b985a55cda445848d38 cc0ef93bf208f76e85168451facb733fbde627b8,Drew Crawford,1313530861'
+'cc0ef93bf208f76e85168451facb733fbde627b8,b19a2e6beaa0b6890e037c540cae686ef5a1a43b,Drew Crawford,1313530773'
+'50350c845ebd14601bb70b985a55cda445848d38,28b444f6f77a91d3454dad2f453811de65732d5c d0088fa58b43a8766b1430dcf58744b3ac1c3f47,Drew Crawford,1313530233'
+'d0088fa58b43a8766b1430dcf58744b3ac1c3f47,b5569413389defb636d231aae675282ab5580447,Drew Crawford,1313530065'
+'acefac9323b5b7d1a4977294a2a106f844ec220d,065549ec67ebd2b1e6fe71dc19bf5ac567aae93a b5569413389defb636d231aae675282ab5580447,Bion Oren,1313529194'
+'065549ec67ebd2b1e6fe71dc19bf5ac567aae93a,28b444f6f77a91d3454dad2f453811de65732d5c,Bion Oren,1313528964'
+'a83490b6bb52a43914941dfe87570b338ca31bb4,28b444f6f77a91d3454dad2f453811de65732d5c,Bion Oren,1313521309'
+'b5569413389defb636d231aae675282ab5580447,8d174f6e033a8d20265026badf323b7264bff9df,Bion Oren,1313520217'
+'d9d00ab4be6eda4495550d9801cc66958c00a12c,10500bf4987b0bdccfaa14408cb3b68aad0506e5,Bion Oren,1313519203'
+'b4a48a0d8e4f2adbd26d1c4c4627d9bcbd7a4cd5,0f2d3d06b7349c2c59faf5f28c7998dde24f1415,Bion Oren,1313516708'
+'28b444f6f77a91d3454dad2f453811de65732d5c,181c71221500b55cf69bb3ac5f3c37a01ca403d4 924eb545c0f8bd146b7969906a387266f8ffab2e,Drew Crawford,1313477826'
+'181c71221500b55cf69bb3ac5f3c37a01ca403d4,0c5cbdf60395c9d9f272d9c4ed3e214a8d314d89 42e0a368081f2a1332633312d106bbcd4caef475,Drew Crawford,1313476598'
+'0c5cbdf60395c9d9f272d9c4ed3e214a8d314d89,1008cbe9128ad93b0dacb92c81df488019c01495 9c1716e4ba4a43a5673ebe763a0773f7db97b3a7,Drew Crawford,1313453777'
+'10500bf4987b0bdccfaa14408cb3b68aad0506e5,c052bfaea7cdfac4389d5aa3ac4b3173ae7213bf,Bion Oren,1313451931'
+'1008cbe9128ad93b0dacb92c81df488019c01495,c052bfaea7cdfac4389d5aa3ac4b3173ae7213bf 037af0f226daebd98ba436dc310321014d10f2e8,Drew Crawford,1313451872'
+'c052bfaea7cdfac4389d5aa3ac4b3173ae7213bf,2f6ac286ef01deb36792ffaa3343868394a3852d,Bion Oren,1313447749'
+'b19a2e6beaa0b6890e037c540cae686ef5a1a43b,2f6ac286ef01deb36792ffaa3343868394a3852d,Bion Oren,1313445479'
 '80a6cb3dfd727f5f70539bf8c56ed99d1e72f8fa,2f6ac286ef01deb36792ffaa3343868394a3852d,Bion Oren,1313005774'
 '42e0a368081f2a1332633312d106bbcd4caef475,2f6ac286ef01deb36792ffaa3343868394a3852d,Bion Oren,1313004900'
 '037af0f226daebd98ba436dc310321014d10f2e8,2f6ac286ef01deb36792ffaa3343868394a3852d,Bion Oren,1313004002'
merged
  result 100644 be476f564fac3db41b33a155165be724d927fb84 truth_or_trash.log
  our    100644 43ef050432261b641b8bfeb9301604f8d68e0202 truth_or_trash.log
@@ -1,3 +1,5 @@
+2
+'e98eb15d9d85b527d1b6020805795b7122b797c4'
 'e98eb15d9d85b527d1b6020805795b7122b797c4,8e2cbb8aa161aab96ff8be0fec0a6afa0dfd4129 ac752d1413f4eec2cc8aa1654a7a026881edb702,Bion Oren,1312830038'
 'ac752d1413f4eec2cc8aa1654a7a026881edb702,aa2c9ddfebd7cd358314bcfd733ab414693dead3,Bion Oren,1312827397'
 '8e2cbb8aa161aab96ff8be0fec0a6afa0dfd4129,bf4ad2e4dafd186f7e6a18c1f173650c52e3f419,Drew Crawford,1312787024'
changed in both
  base   100644 53b6591ae92595aa6c67c0e58c2700f92c330616 truth_trash.png
  our    100644 bc77f2d0455e7708f2864216956c843dae0d7942 truth_trash.png
  their  100644 c96b3eeec840e051d5f02ae0207ab8d35b181b79 truth_trash.png
warning: Cannot merge binary files: truth_trash.png (.our vs. .their)

merged
  result 100644 7bac59c1112e613792014d436f9f82f3271db24a two_nodes.log
  our    100644 f89e24b28125dabca451a3faca01b6a503e3358f two_nodes.log
@@ -1,2 +1,4 @@
+2
+'1458b97333509bf701778d577b241104c95df1c7'
 '1458b97333509bf701778d577b241104c95df1c7,48426827fde12b7f49ced4c33db9fb355ea6bbf2,Bion Oren,1312238809'
 '48426827fde12b7f49ced4c33db9fb355ea6bbf2,,Bion Oren,1312236513'